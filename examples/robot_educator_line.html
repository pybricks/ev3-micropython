

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Line Following &mdash; ev3-micropython 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'2.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/javascript" src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Color Sorter" href="color_sorter.html" />
    <link rel="prev" title="Obstacle Avoidance" href="robot_educator_ultrasonic.html" />
    <link rel="stylesheet" href="../_static/css/theme_overrides.css" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/lego-education-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../startinstall.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../startbrick.html">Using the EV3 Brick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../startrun.html">Creating and running programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../startlinux.html">Accessing advanced EV3 features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../startupgrade.html">Upgrading from v1.0 to v2.0</a></li>
</ul>
<p class="caption"><span class="caption-text">Pybricks Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hubs.html"><code class="docutils literal notranslate"><span class="pre">hubs</span></code> – Programmable Hubs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ev3devices.html"><code class="docutils literal notranslate"><span class="pre">ev3devices</span></code> – EV3 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nxtdevices.html"><code class="docutils literal notranslate"><span class="pre">nxtdevices</span></code> – NXT Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iodevices.html"><code class="docutils literal notranslate"><span class="pre">iodevices</span></code> – Generic I/O Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters.html"><code class="docutils literal notranslate"><span class="pre">parameters</span></code> – Parameters and Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html"><code class="docutils literal notranslate"><span class="pre">tools</span></code> – Timing and Data logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robotics.html"><code class="docutils literal notranslate"><span class="pre">robotics</span></code> – Robotics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media.html"><code class="docutils literal notranslate"><span class="pre">media</span></code> – Sounds and Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messaging.html"><code class="docutils literal notranslate"><span class="pre">messaging</span></code> – Messaging</a></li>
</ul>
<p class="caption"><span class="caption-text">Engineering Extras</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../signaltypes.html">Signals and Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motors.html">More about Motors</a></li>
</ul>
<p class="caption"><span class="caption-text">Robot Educator Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="robot_educator_basic.html">Basic Movement</a></li>
<li class="toctree-l1"><a class="reference internal" href="robot_educator_ultrasonic.html">Obstacle Avoidance</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Line Following</a></li>
</ul>
<p class="caption"><span class="caption-text">Core Set Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="color_sorter.html">Color Sorter</a></li>
<li class="toctree-l1"><a class="reference internal" href="robot_arm.html">Robot Arm H25</a></li>
<li class="toctree-l1"><a class="reference internal" href="puppy.html">Puppy</a></li>
<li class="toctree-l1"><a class="reference internal" href="gyro_boy.html">Gyro Boy</a></li>
</ul>
<p class="caption"><span class="caption-text">Expansion Set Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="elephant.html">Elephant</a></li>
<li class="toctree-l1"><a class="reference internal" href="stair_climber.html">Stair Climber</a></li>
<li class="toctree-l1"><a class="reference internal" href="tank_bot.html">Tank Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="znap.html">Znap</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ev3-micropython</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Line Following</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/robot_educator_line.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="line-following">
<h1>Line Following<a class="headerlink" href="#line-following" title="Permalink to this headline">¶</a></h1>
<p>This example project shows how you can make a robotic vehicle track a
line using
the <a class="reference internal" href="../ev3devices.html#pybricks.ev3devices.ColorSensor" title="pybricks.ev3devices.ColorSensor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColorSensor</span></code></a> and the
<a class="reference internal" href="../robotics.html#pybricks.robotics.DriveBase" title="pybricks.robotics.DriveBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DriveBase</span></code></a> class. This works by adjusting the turn rate based on how
much the measured reflection deviates from the threshold value. The threshold
value is selected as the average of the line reflection and the reflection of
the surrounding surface.</p>
<p class="rubric">Building instructions</p>
<p>Click <a class="reference external" href="https://education.lego.com/en-us/support/mindstorms-ev3/building-instructions#robot">here</a> to find all building instructions for the Educator Bot, or use
<a class="reference external" href="https://le-www-live-s.legocdn.com/sc/media/lessons/mindstorms-ev3/building-instructions/ev3-rem-color-sensor-down-driving-base-d30ed30610c3d6647d56e17bc64cf6e2.pdf">this link</a> to go to the color sensor attachment directly.</p>
<div class="figure align-center" id="id1">
<span id="fig-robot-educator-line"></span><img alt="../_images/robot_educator_line.jpg" src="../_images/robot_educator_line.jpg" style="width: 80%;" />
<p class="caption"><span class="caption-number">Figure 25 </span><span class="caption-text">Robot Educator with the Color Sensor</span></p>
</div>
<p class="rubric">Example program</p>
<p>This example uses the track shown in <a class="reference internal" href="#fig-map"><span class="std std-numref">Figure 26</span></a>, but you can adapt this
example to follow other lines as well. Download the
line following track using the link below and print print the required pages.
You can also create your own track by printing other pages.</p>
<p><a class="reference download internal" href="../_downloads/linefollowtiles.pdf" download=""><code class="xref download docutils literal notranslate"><span class="pre">Click</span> <span class="pre">to</span> <span class="pre">download</span> <span class="pre">the</span> <span class="pre">line</span> <span class="pre">following</span> <span class="pre">track.</span></code></a></p>
<div class="figure align-center" id="id2">
<span id="fig-map"></span><img alt="../_images/line.png" src="../_images/line.png" style="width: 50%;" />
<p class="caption"><span class="caption-number">Figure 26 </span><span class="caption-text">Download the line following track and print pages
<code class="docutils literal notranslate"><span class="pre">2,2,2,2,3,3,3,3,11</span></code>.</span></p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pybricks-micropython</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example LEGO® MINDSTORMS® EV3 Robot Educator Color Sensor Down Program</span>
<span class="sd">----------------------------------------------------------------------</span>

<span class="sd">This program requires LEGO® EV3 MicroPython v2.0.</span>
<span class="sd">Download: https://education.lego.com/en-us/support/mindstorms-ev3/python-for-ev3</span>

<span class="sd">Building instructions can be found at:</span>
<span class="sd">https://education.lego.com/en-us/support/mindstorms-ev3/building-instructions#robot</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pybricks.ev3devices</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">ColorSensor</span>
<span class="kn">from</span> <span class="nn">pybricks.parameters</span> <span class="kn">import</span> <span class="n">Port</span>
<span class="kn">from</span> <span class="nn">pybricks.tools</span> <span class="kn">import</span> <span class="n">wait</span>
<span class="kn">from</span> <span class="nn">pybricks.robotics</span> <span class="kn">import</span> <span class="n">DriveBase</span>

<span class="c1"># Initialize the motors.</span>
<span class="n">left_motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">Port</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
<span class="n">right_motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">Port</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>

<span class="c1"># Initialize the color sensor.</span>
<span class="n">line_sensor</span> <span class="o">=</span> <span class="n">ColorSensor</span><span class="p">(</span><span class="n">Port</span><span class="o">.</span><span class="n">S3</span><span class="p">)</span>

<span class="c1"># Initialize the drive base.</span>
<span class="n">robot</span> <span class="o">=</span> <span class="n">DriveBase</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span> <span class="n">right_motor</span><span class="p">,</span> <span class="n">wheel_diameter</span><span class="o">=</span><span class="mf">55.5</span><span class="p">,</span> <span class="n">axle_track</span><span class="o">=</span><span class="mi">104</span><span class="p">)</span>

<span class="c1"># Calculate the light threshold. Choose values based on your measurements.</span>
<span class="n">BLACK</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">WHITE</span> <span class="o">=</span> <span class="mi">85</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">BLACK</span> <span class="o">+</span> <span class="n">WHITE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="c1"># Set the drive speed at 100 millimeters per second.</span>
<span class="n">DRIVE_SPEED</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Set the gain of the proportional line controller. This means that for every</span>
<span class="c1"># percentage point of light deviating from the threshold, we set the turn</span>
<span class="c1"># rate of the drivebase to 1.2 degrees per second.</span>

<span class="c1"># For example, if the light value deviates from the threshold by 10, the robot</span>
<span class="c1"># steers at 10*1.2 = 12 degrees per second.</span>
<span class="n">PROPORTIONAL_GAIN</span> <span class="o">=</span> <span class="mf">1.2</span>

<span class="c1"># Start following the line endlessly.</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Calculate the deviation from the threshold.</span>
    <span class="n">deviation</span> <span class="o">=</span> <span class="n">line_sensor</span><span class="o">.</span><span class="n">reflection</span><span class="p">()</span> <span class="o">-</span> <span class="n">threshold</span>

    <span class="c1"># Calculate the turn rate.</span>
    <span class="n">turn_rate</span> <span class="o">=</span> <span class="n">PROPORTIONAL_GAIN</span> <span class="o">*</span> <span class="n">deviation</span>

    <span class="c1"># Set the drive base speed and turn rate.</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">DRIVE_SPEED</span><span class="p">,</span> <span class="n">turn_rate</span><span class="p">)</span>

    <span class="c1"># You can wait for a short time or do other things in this loop.</span>
    <span class="n">wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="color_sorter.html" class="btn btn-neutral float-right" title="Color Sorter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="robot_educator_ultrasonic.html" class="btn btn-neutral float-left" title="Obstacle Avoidance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2020 The LEGO Group. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div class="disclaimer">LEGO, the LEGO logo, MINDSTORMS and the MINDSTORMS EV3 logo are               trademarks and/or copyrights of the LEGO Group.</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>